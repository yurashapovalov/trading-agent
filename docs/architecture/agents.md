# Агенты

Каждый агент делает одну задачу хорошо.

## Parser

**Задача:** Понять что хочет пользователь.

```
"топ 5 волатильных дней за 2024"
         ↓
{
  intent: "data",
  operation: "top_n",
  top_n: 5,
  sort_by: "range",
  period: { type: "year", value: "2024" }
}
```

Parser определяет:
- **intent** — что делать (data, chitchat, concept)
- **period** — за какой период
- **operation** — какую операцию (stats, top_n, compare)
- **filters** — какие фильтры применить
- **unclear** — что нужно уточнить

Если чего-то не хватает — помечает в `unclear` и передаёт Clarifier.

## Clarifier

**Задача:** Уточнить недостающую информацию.

```
User: "покажи статистику"
      ↓
Parser: unclear = ["period", "metric"]
      ↓
Clarifier: "За какой период? И что посчитать — волатильность, доходность?"
      ↓
User: "волатильность за 2024"
      ↓
Clarifier: "Ок, смотрим волатильность за 2024"
      → clarified_query = "волатильность за 2024"
      ↓
Parser: (парсит уже полный запрос)
```

Особенности:
- Отвечает на языке пользователя (RU/EN/ES)
- Дружелюбный тон, но профессиональный
- Формирует полный запрос из кусочков разговора

## Responder

**Задача:** Отвечать на простые вопросы без данных.

Два режима:
- **chitchat** — приветствия, благодарности, прощания
- **concept** — объяснение терминов (OPEX, волатильность, гэп)

```
User: "привет"
      ↓
Parser: intent = "chitchat"
      ↓
Responder: "Привет! Чем могу помочь с анализом NQ?"
```

## Presenter

**Задача:** Превратить данные в понятный текст.

```
Executor возвращает:
{
  rows: [...252 дня...],
  stats: { avg_range: 1.2%, green_pct: 54% },
  events: ["3× OPEX", "1× NFP"]
}
      ↓
Presenter:
"В 2024 году средняя волатильность NQ составила 1.2%.
 Зелёных дней было 54%. Среди событий — 3 экспирации OPEX."
```

Presenter знает про:
- Праздники (market holidays)
- События (OPEX, NFP, Quad Witching)
- Паттерны свечей (hammer, doji, engulfing)

И упоминает их в контексте, когда релевантно.
