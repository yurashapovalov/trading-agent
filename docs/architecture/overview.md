# Architecture Overview

## Главный принцип

**Code for Facts, LLM for Text**

```
Код считает цифры → LLM пишет текст
```

- Код вычисляет всё детерминированно: статистику, паттерны, события
- LLM только превращает готовые факты в человеческий текст
- LLM никогда не видит сырые данные — не может галлюцинировать цифры

## Поток данных

```
Пользователь          Агенты                    Данные
     │                   │                        │
     │  "волатильность"  │                        │
     ├──────────────────►│                        │
     │                   │                        │
     │              ┌────┴────┐                   │
     │              │ Parser  │ понимает вопрос   │
     │              └────┬────┘                   │
     │                   │ ParsedQuery            │
     │              ┌────┴────┐                   │
     │              │Executor │◄──────────────────┤ SQL/DuckDB
     │              └────┬────┘                   │
     │                   │ DataFrame + stats      │
     │              ┌────┴────┐                   │
     │              │Presenter│ форматирует       │
     │              └────┬────┘                   │
     │                   │                        │
     │◄──────────────────┤                        │
     │  "Средняя..."     │                        │
```

## Ключевые компоненты

| Компонент | Задача |
|-----------|--------|
| **Parser** | Понимает вопрос → структурированный запрос |
| **Clarifier** | Уточняет если чего-то не хватает |
| **Executor** | Выполняет запрос к данным |
| **Presenter** | Превращает данные в человеческий текст |
| **Memory** | Помнит контекст разговора |

## Документация

- [Агенты](agents.md) — как работает каждый агент
- [Граф](graph.md) — как агенты связаны между собой
- [Память](memory.md) — кэширование и история разговора
- [Данные](data-layer.md) — как обрабатываются запросы к данным
- [Конфиги](config.md) — паттерны, события, праздники
